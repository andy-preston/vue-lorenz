#!/bin/bash

# BE CAREFUL - this scrubs you whole system's Docker files
# docker system prune --volumes -a

[ -n "$2" ] && appName=$2 || appName="vue-lorenz"

case $1 in
'run')
    USER_ADD="useradd -m -u $(id -u) dev -s /bin/bash"
    PERMO="chown dev /home/dev"
    PERMD="chmod 700 /home/dev /home/dev/.ssh"
    docker run -it --rm --network="host" \
        --volume $(pwd):/usr/local/src \
        --volume $HOME/.ssh:/home/dev/.ssh \
        --name running-$appName $appName \
        sh -c "$USER_ADD ; $PERMO ; $PERMD ; exec su dev"
    ;;
'shell')
    docker container exec -it running-$appName bash
    ;;
'build')
    docker build -t $appName ./docker
    ;;
*)
    echo "./docker/container [run|shell|build] app-name"
    ;;
esac

